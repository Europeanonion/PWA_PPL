<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Ultimate Push Pull Legs System</title>
  <meta name="description" content="Track your progress through the Push-Pull-Legs workout program">
  <meta name="theme-color" content="#C38803">
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="./assets/icons/optimized/Icon-192.png">
  <!-- Preload critical resources -->
  <link rel="preload" href="./assets/js/workout-storage.min.js" as="script">
  <link rel="preload" href="./assets/css/modern-ui.min.css" as="style">
  <link rel="prefetch" href="./assets/js/progress-tracker.min.js">
  <!-- Modern UI Stylesheet -->
  <link rel="stylesheet" href="./assets/css/modern-ui.min.css">
  <!-- Weight Tracker Stylesheet (for backward compatibility) -->
  <link rel="stylesheet" href="./assets/css/weight-tracker.min.css">
</head>
<body>
  <header>
    <h1 class="app-title">The Ultimate Push Pull Legs System</h1>
    <nav class="phase-selector">
      <button class="phase-btn active" onclick="showPhase('phase1')">Phase 1</button>
      <button class="phase-btn" onclick="showPhase('phase2')">Phase 2</button>
      <button class="phase-btn" onclick="showPhase('phase3')">Phase 3</button>
    </nav>
  </header>
  
  <main class="container">
    <section class="data-management">
      <button onclick="workoutStorage.exportData()">Export Data</button>
      <button onclick="document.getElementById('import-file').click()">Import Data</button>
      <button onclick="workoutStorage.clearData()">Clear Data</button>
      <input type="file" id="import-file" style="display: none;" accept="application/json" onchange="workoutStorage.importData(this.files[0])">
    </section>
    
    <!-- PHASE 1 -->
    <section id="phase1" class="phase-content active">
      <div class="phase-description">Phase 1 - Base Hypertrophy (Moderate Volume, Moderate Intensity)</div>
      
      <div class="week-selector">
        <button class="week-btn active" onclick="showWeek('phase1', 'week1')">Week 1</button>
        <button class="week-btn" onclick="showWeek('phase1', 'week2')">Week 2</button>
        <button class="week-btn" onclick="showWeek('phase1', 'week3')">Week 3</button>
        <button class="week-btn" onclick="showWeek('phase1', 'week4')">Week 4</button>
        <button class="week-btn" onclick="showWeek('phase1', 'week5')">Week 5</button>
        <button class="week-btn" onclick="showWeek('phase1', 'week6')">Week 6</button>
      </div>
      
      <!-- Week 1 Content -->
      <div id="phase1-week1" class="week-content active">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <!-- Week 2-6 Content -->
      <div id="phase1-week2" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase1-week3" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase1-week4" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase1-week5" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase1-week6" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
    </section>
    
    <!-- PHASE 2 -->
    <section id="phase2" class="phase-content">
      <div class="phase-description">Phase 2 - Maximum Effort (Low volume, high intensity)</div>
      
      <div class="week-selector">
        <button class="week-btn active" onclick="showWeek('phase2', 'week1')">Week 1</button>
        <button class="week-btn" onclick="showWeek('phase2', 'week2')">Week 2</button>
        <button class="week-btn" onclick="showWeek('phase2', 'week3')">Week 3</button>
        <button class="week-btn" onclick="showWeek('phase2', 'week4')">Week 4</button>
        <button class="week-btn" onclick="showWeek('phase2', 'week5')">Week 5</button>
        <button class="week-btn" onclick="showWeek('phase2', 'week6')">Week 6</button>
      </div>
      
      <!-- Phase 2 Week 1 Content -->
      <div id="phase2-week1" class="week-content active">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <!-- Week 2-6 Content -->
      <div id="phase2-week2" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase2-week3" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase2-week4" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase2-week5" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase2-week6" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
    </section>
    
    <!-- PHASE 3 -->
    <section id="phase3" class="phase-content">
      <div class="phase-description">Phase 3 - Supercompensation (High volume, moderate intensity)</div>
      
      <div class="week-selector">
        <button class="week-btn active" onclick="showWeek('phase3', 'week1')">Week 1</button>
        <button class="week-btn" onclick="showWeek('phase3', 'week2')">Week 2</button>
        <button class="week-btn" onclick="showWeek('phase3', 'week3')">Week 3</button>
        <button class="week-btn" onclick="showWeek('phase3', 'week4')">Week 4</button>
        <button class="week-btn" onclick="showWeek('phase3', 'week5')">Week 5</button>
        <button class="week-btn" onclick="showWeek('phase3', 'week6')">Week 6</button>
      </div>
      
      <!-- Phase 3 Week 1 Content -->
      <div id="phase3-week1" class="week-content active">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <!-- Week 2-6 Content -->
      <div id="phase3-week2" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase3-week3" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase3-week4" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase3-week5" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
      
      <div id="phase3-week6" class="week-content">
        <!-- Workout days will be loaded dynamically by workout-loader.js -->
      </div>
    </section>
  </main>
  
  <!-- RPE Guide Modal -->
  <div id="rpe-guide-modal" class="modal-overlay">
    <div class="modal-content">
      <span class="modal-close" onclick="document.getElementById('rpe-guide-modal').style.display='none'">&times;</span>
      <h2 class="modal-title">RPE Scale Guide</h2>
      <p>RPE (Rate of Perceived Exertion) is a scale used to measure the intensity of your exercise.</p>
      <table class="modal-table">
        <tr>
          <th>RPE</th>
          <th>Description</th>
          <th>Reps in Reserve</th>
        </tr>
        <tr>
          <td>10</td>
          <td>Maximum effort</td>
          <td>0 - Could not do more reps</td>
        </tr>
        <tr>
          <td>9</td>
          <td>Very hard effort</td>
          <td>1 - Could do 1 more rep</td>
        </tr>
        <tr>
          <td>8</td>
          <td>Hard effort</td>
          <td>2 - Could do 2 more reps</td>
        </tr>
        <tr>
          <td>7</td>
          <td>Moderate effort</td>
          <td>3 - Could do 3 more reps</td>
        </tr>
        <tr>
          <td>6</td>
          <td>Somewhat hard</td>
          <td>4 - Could do 4 more reps</td>
        </tr>
        <tr>
          <td>5</td>
          <td>Light effort</td>
          <td>5 - Could do 5 more reps</td>
        </tr>
      </table>
      <p style="margin-top: 15px;">This program primarily uses RPE 8-9 for main lifts and RPE 9 for accessory exercises.</p>
    </div>
  </div>

  <footer>
    <p>The Ultimate Push Pull Legs System - Save this page for offline use</p>
    <p>To use offline: Open in Safari, tap share icon, then "Add to Home Screen"</p>
    <p>Each phase is 6 weeks long. Complete all three phases for maximum results.</p>
    <p><a href="#" onclick="document.getElementById('rpe-guide-modal').style.display='block'; return false;">RPE Guide</a></p>
  </footer>
  <!-- JavaScript -->
  <script>
    function showPhase(phaseId) {
      // Hide all phase content
      const phaseContents = document.querySelectorAll('.phase-content');
      phaseContents.forEach(content => {
        content.classList.remove('active');
      });
      
      // Deactivate all phase buttons
      const phaseButtons = document.querySelectorAll('.phase-btn');
      phaseButtons.forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected phase content
      document.getElementById(phaseId).classList.add('active');
      
      // Activate selected phase button
      const activeButton = document.querySelector(`.phase-btn[onclick="showPhase('${phaseId}')"]`);
      activeButton.classList.add('active');
      
      // Reset week selection for the selected phase
      showWeek(phaseId, 'week1');
    }
    
    function showWeek(phaseId, weekId) {
      // Hide all week content for the current phase
      const weekContents = document.querySelectorAll(`#${phaseId} .week-content`);
      weekContents.forEach(content => {
        content.classList.remove('active');
      });
      
      // Deactivate all week buttons for the current phase
      const weekButtons = document.querySelectorAll(`#${phaseId} .week-btn`);
      weekButtons.forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Show selected week content
      document.getElementById(`${phaseId}-${weekId}`).classList.add('active');
      
      // Activate selected week button
      const activeButton = document.querySelector(`#${phaseId} .week-btn[onclick="showWeek('${phaseId}', '${weekId}')"]`);
      activeButton.classList.add('active');
      
      // Update progress indicators
      updateWorkoutProgress();
    }
    
    function toggleNotes(noteId) {
      const notesElement = document.getElementById(noteId);
      if (notesElement.style.display === 'table-row') {
        notesElement.style.display = 'none';
        notesElement.classList.remove('visible');
      } else {
        notesElement.style.display = 'table-row';
        notesElement.classList.add('visible');
      }
    }
    
    function toggleSubs(subsId) {
      const subsElement = document.getElementById(subsId);
      if (subsElement.style.display === 'block') {
        subsElement.style.display = 'none';
        subsElement.classList.remove('visible');
      } else {
        subsElement.style.display = 'block';
        subsElement.classList.add('visible');
      }
    }
    
    // Update workout progress indicators
    function updateWorkoutProgress() {
      // Get all active workout days
      const activeWorkoutDays = document.querySelectorAll('.week-content.active .workout-day');
      
      activeWorkoutDays.forEach(day => {
        // Get all checkboxes in this workout day
        const checkboxes = day.querySelectorAll('.completed-checkbox');
        const totalExercises = new Set();
        const completedExercises = new Set();
        
        // Count total and completed exercises
        checkboxes.forEach(checkbox => {
          const exerciseId = checkbox.dataset.exercise;
          totalExercises.add(exerciseId);
          
          if (checkbox.checked) {
            completedExercises.add(exerciseId);
          }
        });
        
        // Calculate progress percentage
        const totalCount = totalExercises.size;
        const completedCount = completedExercises.size;
        const progressPercent = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
        
        // Update progress bar
        const progressBar = day.querySelector('.progress-bar-fill');
        if (progressBar) {
          progressBar.style.width = `${progressPercent}%`;
        }
        
        // Update progress stats
        const progressStats = day.querySelector('.progress-stats');
        if (progressStats) {
          progressStats.innerHTML = `
            <span>${completedCount}/${totalCount} exercises completed</span>
            <span>${progressPercent}%</span>
          `;
        }
      });
    }
    
    // Register service worker for PWA functionality
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
            
            // Check for updates
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // New service worker is installed but waiting to activate
                  if (window.workoutStorage && window.workoutStorage.showFeedback) {
                    window.workoutStorage.showFeedback('App update available. Refresh to update.', 'info');
                  }
                }
              });
            });
          })
          .catch(error => {
            console.error('ServiceWorker registration failed: ', error);
          });
          
        // Handle service worker updates
        let refreshing = false;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (!refreshing) {
            refreshing = true;
            window.location.reload();
          }
        });
      });
    }
    
    // Add install prompt for PWA
    let deferredPrompt;
    const installButton = document.createElement('button');
    installButton.style.display = 'none';
    installButton.className = 'install-button';
    installButton.textContent = 'Install App';
    
    window.addEventListener('beforeinstallprompt', (e) => {
      // Prevent Chrome 67 and earlier from automatically showing the prompt
      e.preventDefault();
      
      // Stash the event so it can be triggered later
      deferredPrompt = e;
      
      // Create and show the install button
      if (!document.querySelector('.install-button')) {
        document.querySelector('header').appendChild(installButton);
        installButton.style.display = 'block';
        
        installButton.addEventListener('click', () => {
          // Show the install prompt
          deferredPrompt.prompt();
          
          // Wait for the user to respond to the prompt
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
              console.log('User accepted the install prompt');
              if (window.workoutStorage && window.workoutStorage.showFeedback) {
                window.workoutStorage.showFeedback('App installed successfully!', 'success');
              }
            } else {
              console.log('User dismissed the install prompt');
            }
            
            // Clear the saved prompt
            deferredPrompt = null;
            
            // Hide the button
            installButton.style.display = 'none';
          });
        });
      }
    });
    
    // Initialize app on load
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize workout data
      if (window.workoutStorage) {
        window.workoutStorage.initialize();
      }
      
      // Setup exercise tracking
      if (window.setupExerciseTracking) {
        window.setupExerciseTracking();
      }
      
      // Initialize network status
      if (window.networkStatus) {
        window.networkStatus.init();
      }
      
      // Add event listeners for checkbox changes to update progress
      document.querySelectorAll('.completed-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', updateWorkoutProgress);
      });
      
      // Initial progress update
      updateWorkoutProgress();
      
      // Add event listeners for phase and week changes
      document.querySelectorAll('.phase-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          // Wait for the phase change to complete
          setTimeout(() => {
            if (window.setupExerciseTracking) {
              window.setupExerciseTracking();
            }
            updateWorkoutProgress();
          }, 100);
        });
      });
      
      document.querySelectorAll('.week-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          // Wait for the week change to complete
          setTimeout(() => {
            if (window.setupExerciseTracking) {
              window.setupExerciseTracking();
            }
            updateWorkoutProgress();
          }, 100);
        });
      });
    });
  </script>
  <script src="./assets/js/workout-storage.min.js"></script>
  <script src="./assets/js/exercise-inputs.min.js"></script>
  <script src="./assets/js/progress-tracker.min.js"></script>
  <script src="./assets/js/network-status.min.js"></script>
  <script src="./assets/js/workout-loader.min.js"></script>
</body>
</html>